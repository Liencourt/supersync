{% extends "base.html" %}
{% load static %}

{% block title %}Dashboard | SuperSync{% endblock %}

{% block content %}

<div class="row mb-3">
    <div class="col-12">
        <div class="page-title-box">
            <h4 class="page-title">Dashboard Geral</h4>
            <p class="text-muted">Bem-vindo, <strong>{{ user.name|default:user.username }}</strong>! Aqui está o resumo da sua operação hoje.</p>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6 col-xl-4">
        <div class="card widget-flat shadow-sm">
            <div class="card-body">
                <div class="float-end">
                    <i class="ti ti-layout-grid text-primary widget-icon"></i>
                </div>
                <h5 class="text-muted fw-normal mt-0" title="Grades abertas para compra">Grades Abertas</h5>
                <h3 class="mt-3 mb-3 text-primary">{{ kpi_grades|default:"0" }}</h3>
                <p class="mb-0 text-muted">
                    <span class="text-success me-2"><i class="ti ti-arrow-up-right"></i> 2</span>
                    <span class="text-nowrap">Novas esta semana</span>
                </p>
            </div>
        </div>
    </div>

    <div class="col-md-6 col-xl-4">
        <div class="card widget-flat shadow-sm">
            <div class="card-body">
                <div class="float-end">
                    <i class="ti ti-file-invoice text-danger widget-icon"></i>
                </div>
                <h5 class="text-muted fw-normal mt-0" title="Contratos aguardando apuração">Contratos em Análise</h5>
                <h3 class="mt-3 mb-3 text-danger">{{ kpi_contratos|default:"0" }}</h3>
                <p class="mb-0 text-muted">
                    <span class="text-danger me-2"><i class="ti ti-alert-circle"></i> 1</span>
                    <span class="text-nowrap">Requer atenção urgente</span>
                </p>
            </div>
        </div>
    </div>

    <div class="col-md-6 col-xl-4">
        <div class="card widget-flat shadow-sm">
            <div class="card-body">
                <div class="float-end">
                    <i class="ti ti-users text-info widget-icon"></i>
                </div>
                <h5 class="text-muted fw-normal mt-0" title="Total de Fornecedores Ativos">Fornecedores Ativos</h5>
                <h3 class="mt-3 mb-3 text-info">{{ kpi_fornecedores|default:"0" }}</h3>
                <p class="mb-0 text-muted">
                    <span class="text-nowrap">Base atualizada</span>
                </p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    
    <div class="col-xl-8">
        <div class="card shadow-sm" style="height: 100%;">
            <div class="card-body">
                <h4 class="header-title mb-3">Volume de Apuração (Últimos 6 Meses)</h4>
                <div dir="ltr">
                    <div id="revenue-chart" class="apex-charts" data-colors="#727cf5,#0acf97"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-4">
        <div class="card shadow-sm">
            <div class="card-body">
                <h4 class="header-title mb-3">Acesso Rápido</h4>

                <div class="d-grid gap-3">
                    <a href="{% url 'apuracao_grade:grade-create'|default:'#' %}" class="btn btn-outline-primary btn-lg text-start">
                        <i class="ti ti-plus me-2"></i> Nova Grade de Compra
                    </a>
                    
                    <a href="{% url 'contratos:listar_contratos'|default:'#' %}" class="btn btn-outline-secondary btn-lg text-start">
                        <i class="ti ti-file-plus me-2"></i> Cadastrar Contrato
                    </a>

                    <a href="{% url 'apuracao_grade:evento-list'|default:'#' %}" class="btn btn-light btn-lg text-start border">
                        <i class="ti ti-calendar-event me-2"></i> Gerenciar Eventos
                    </a>
                </div>
            </div>
        </div>

        <div class="card shadow-sm mt-3">
            <div class="card-body">
                <h4 class="header-title mb-3">Atividade Recente</h4>
                <div class="slimscroll" style="max-height: 200px;">
                    <div class="timeline-alt pb-0">
                        <div class="timeline-item">
                            <i class="ti ti-circle-check bg-success-lighten text-success timeline-icon"></i>
                            <div class="timeline-item-info">
                                <a href="#" class="text-success fw-bold mb-1 d-block">Grade #102 Finalizada</a>
                                <small>Há 2 horas</small>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <i class="ti ti-user-plus bg-info-lighten text-info timeline-icon"></i>
                            <div class="timeline-item-info">
                                <a href="#" class="text-info fw-bold mb-1 d-block">Novo Usuário: Pablo</a>
                                <small>Há 5 horas</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_javascript %}
<script src="{% static 'vendor/apexcharts/apexcharts.min.js' %}"></script> <script>
    document.addEventListener("DOMContentLoaded", function() {
        var options = {
            chart: {
                height: 318,
                type: 'area',
                toolbar: { show: false }
            },
            dataLabels: { enabled: false },
            stroke: { curve: 'smooth', width: 2 },
            series: [{
                name: 'Grades Criadas',
                data: [10, 20, 15, 25, 20, 30, 40]
            }, {
                name: 'Contratos Apurados',
                data: [5, 15, 10, 20, 15, 25, 20]
            }],
            xaxis: {
                categories: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul'],
            },
            colors: ['#727cf5', '#0acf97'],
            legend: { show: true, position: 'top', horizontalAlign: 'left' },
            grid: { row: { colors: ['transparent', 'transparent'], opacity: 0.2 }, borderColor: '#f1f3fa' }
        };

        // Verifica se a div existe antes de renderizar para não dar erro no console
        if (document.querySelector("#revenue-chart")) {
            var chart = new ApexCharts(document.querySelector("#revenue-chart"), options);
            chart.render();
        }
    });
</script>
{% endblock %}